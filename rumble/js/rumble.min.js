/*! rumble - v1.0.0 - 2015-03-24
* https://github.com/gmoon/rumble
* Copyright (c) 2015 George Moon; Licensed Apache 2.0 */

var documentDomainError;angular.module("webPerformanceApp",["ngSanitize"]).directive("sbLoad",["$parse",function(a){return{restrict:"A",link:function(b,c,d){var e=a(d.sbLoad);c.on("load",function(a){b.$apply(function(){e(b,{$event:a})})})}}}]).filter("percentage",["$window",function(a){return function(b,c,d){return c=angular.isNumber(c)?c:0,d=d||"%",a.isNaN(b)?"":Math.round(b*Math.pow(10,c+2))/Math.pow(10,c)+d}}]).filter("abs",[function(){return function(a){return Math.abs(a)}}]).controller("WebPerformanceController",["$sce","$scope","$interval","webPerfConfig","wErrors","wMetrics",function(a,b,c,d,e,f){b.validConfig=0,b.stages=f.getStages(),b.visibleMetrics=f.getVisibleMetrics(),b.errors=e.getErrors(),b.stats=f.getStats();var g;b.onIframeLoad=function(a){b.validConfig&&(f.processIframeLoad(a.currentTarget.id,a.currentTarget,b.battle.left.id,b.battle.right.id),b.stats[b.battle.left.id].total.count===b.stats[b.battle.right.id].total.count&&b.recalcPercentage())},b.fight=function(){if(!angular.isDefined(g)){try{b.battle.contestants.forEach(function(a){$("#"+a.id)[0].contentWindow.location.reload()})}catch(a){e.addError(a),console.log(a)}g=c(function(){try{b.battle.contestants.forEach(function(a){$("#"+a.id)[0].contentWindow.location.reload()})}catch(a){e.addError(a),console.log(a)}},b.battle.samplingInterval)}},b.recalcPercentage=function(){var a=b.stats[b.battle.left.id].total.current,c=b.stats[b.battle.right.id].total.current;b.pctSlower=(c-a)/a},b.stopFight=function(){angular.isDefined(g)&&(c.cancel(g),g=void 0)},b.isStarted=function(){return angular.isDefined(g)?!0:!1},b.toggleFight=function(){angular.isDefined(g)?b.stopFight():b.fight()},b.resetFight=function(){b.pctSlower=0,b.stats=f.clearStats(),b.battle.contestants.forEach(function(a){b.stats[a.id]=f.initMetrics()})},b.clearErrorMessage=function(a){e.clearErrorMessage(a)},b.promoteFighter=function(a,c){b.battle[a]=b.battle.contestants[c],b.recalcPercentage()},angular.isDefined(documentDomainError)&&(e.addError(documentDomainError),console.log(documentDomainError)),d.getConfig().then(function(c){b.battle=c,b.battle.contestants.map(function(b){b.url=a.trustAsResourceUrl(b.url)}),b.battle.left=b.battle.contestants[0],b.battle.right=b.battle.contestants[1],b.validConfig=1,b.resetFight(),b.fight()},function(a){e.addError(a),console.log(a)})}]).factory("webPerfConfig",function(a,b){var c={},d={},e=function(){for(var a,b=/\+/g,c=/([^&=]+)=?([^&]*)/g,e=function(a){return decodeURIComponent(a.replace(b," "))},f=window.location.search.substring(1);a=c.exec(f);)d[e(a[1])]=e(a[2])};return c.getConfig=function(){e();var c=b.defer();return a({method:"GET",url:d.config}).success(function(a){c.resolve(a)}).error(function(a,b,d,e){c.reject([e.method,e.url,"returned",b].join(" "))}),c.promise},c}).factory("wErrors",function(){var a={},b=[];return a.addError=function(a){var c=$.grep(b,function(b){return b.message===a.toString()});0===c.length?b.push({message:a.toString(),count:1}):c[0].count++},a.clearErrorMessage=function(a){b.splice(a,1)},a.getErrors=function(){return b},a}).factory("wMetrics",function(){var a={},b=["total","redirect","appCache","dns","tcp","ssl","request","response","processing","onLoad"],c=["min","max","avg","stdev","current","count","sum"],d=["current","min","avg","max"],e={};a.getStages=function(){return b},a.getVisibleMetrics=function(){return d},a.getStats=function(){return e},a.clearStats=function(){return e={}},a.initMetrics=function(){var a=b.reduce(function(a,b){var d=c.reduce(function(a,b){return a[b]="min"===b?1e6:0,a},{});return a[b]=d,a},{});return a};var f=function(a,b,c){var d=e[a][b];d.current=c,d.count++,d.sum+=c,d.max=c>d.max?c:d.max,d.min=c<d.min?c:d.min,d.avg=Math.floor(d.sum/d.count)};return a.processIframeLoad=function(a,b){var c=b.contentWindow.performance.timing,d=c.navigationStart,e=c.redirectEnd-c.redirectStart,g=c.domainLookupStart-c.fetchStart,h=c.domainLookupEnd-c.domainLookupStart,i=c.connectEnd-c.connectStart,j=c.secureConnectionStart>0?c.connectEnd-c.secureConnectionStart:0,k=c.responseStart-c.requestStart,l=c.responseEnd-c.responseStart,m=c.loadEventStart-c.domLoading,n=c.loadEventEnd-c.loadEventStart,o=c.loadEventEnd-d;f(a,"redirect",e),f(a,"appCache",g),f(a,"dns",h),f(a,"tcp",i),f(a,"ssl",j),f(a,"request",k),f(a,"response",l),f(a,"processing",m),f(a,"onLoad",n),f(a,"total",o)},a.initMetrics(),a});
//# sourceMappingURL=rumble.min.js.map